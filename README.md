# Projeto para subir em Docker

Esta branch tem por objetivo guardar o projeto na versão para executar com o Docker.
Collection do Postman pode ser encontrado dentro da pasta do projeto.
Curso foi criado utilizando uma versão antiga do Docker, foi adaptado depois para ter o arquivo docker-compose.yml
por isso das diferenças na criação e execução dos containers demonstradas dentro da página de Recursos mencionada abaixo. 

Para visualizar recursos utilizados durante a trilha de criação dos containers, imagens e outros acesse:

[Recursos](https://github.com/Sammy192/MicroserviceDevSuperiorWsWorker/blob/docker/Resources.md)

Para executar o projeto é necessário ter um repositório git com os arquivos de configuração, semelhante a este utilizado no curso:

[Repo Config](https://github.com/acenelio/ms-course-configs)

## OBS:

Necessário configurar variáveis de ambiente local para que estejam disponíveis no momento de execução do projeto para que o serviço de config consiga logar em seu repo git
de configuração e consiga obter os arquivos necessários de ambiente.
Tais var de ambientes são utilizadas pelo projeto 'hr-config-server' como configuradas no docker-compose.yml

      - GITHUB_USER: ${GITHUB_USER} (Seu usuário da conta git)
      - GITHUB_PASS: ${GITHUB_PASS} (Seu token da conta git - necessário criar um token para ser utilizado para este fim)
      - JWT-SECRET: ${MY-JWT-SECRET} (config de projeto)

Projeto na versão Java 11;
E SPRING BOOT 2.3.4;

Inicie os containers dockers nesta ordem aguardando a completa inicialização de cada um antes de iniciar o próximo.
obs: nesse momento objetivo não esta em configurar os containers para serem auto executáveis, por isso essa ordem.

1 - hr-worker-pg12

2 - hr-user-pg12

3 - ms-pgadmin

4 - hr-config-server

5 - hr-eureka-server

6 - hr-api-gateway-zuul

7 - hr-user

8 - hr-oauth

9 - hr-worker

10 - hr-payroll




## Após iniciar pela primeira vez criar a estrutura de banco: 
( se necessário faça os inserts também, porém existindo as tabelas, o projeto ao ser iniciado faz os inserts através do data.sql)
Scrips disponíveis no projeto no arquivo create.sql e os inserts no data.sql

### No banco: db_hr_user
```
create table tb_role (id int8 generated by default as identity, role_name varchar(255), primary key (id));
create table tb_user (id int8 generated by default as identity, email varchar(255), name varchar(255), password varchar(255), primary key (id));
create table tb_user_role (user_id int8 not null, role_id int8 not null, primary key (user_id, role_id));
alter table if exists tb_user add constraint UK_4vih17mube9j7cqyjlfbcrk4m unique (email);
alter table if exists tb_user_role add constraint FKea2ootw6b6bb0xt3ptl28bymv foreign key (role_id) references tb_role;
alter table if exists tb_user_role add constraint FK7vn3h53d0tqdimm8cp45gc0kl foreign key (user_id) references tb_user;
```
----------------------------

```
INSERT INTO tb_user (name, email, password) VALUES ('Nina Brown', 'nina@gmail.com', '$2a$10$NYFZ/8WaQ3Qb6FCs.00jce4nxX9w7AkgWVsQCG6oUwTAcZqP9Flqu');
INSERT INTO tb_user (name, email, password) VALUES ('Leia Red', 'leia@gmail.com', '$2a$10$NYFZ/8WaQ3Qb6FCs.00jce4nxX9w7AkgWVsQCG6oUwTAcZqP9Flqu');

INSERT INTO tb_role (role_name) VALUES ('ROLE_OPERATOR');
INSERT INTO tb_role (role_name) VALUES ('ROLE_ADMIN');

INSERT INTO tb_user_role (user_id, role_id) VALUES (1, 1);
INSERT INTO tb_user_role (user_id, role_id) VALUES (2, 1);
INSERT INTO tb_user_role (user_id, role_id) VALUES (2, 2);
```

### No banco: db_hr_worker
```
create table tb_worker (id int8 generated by default as identity, daily_income float8, name varchar(255), primary key (id));
```
-------------------------- 
```
INSERT INTO tb_worker (name, daily_Income) VALUES ('Bob', 200.0);
INSERT INTO tb_worker (name, daily_Income) VALUES ('Maria', 300.0);
INSERT INTO tb_worker (name, daily_Income) VALUES ('Alex', 250.0);
```

Imagem de config da estrutura de banco no PgAdmin:
Acesso PgAdmin configurado no docker-compose.yml -> localhost:5050

![image](https://github.com/user-attachments/assets/a2d26e81-8935-4c20-a727-738239436e9f)

![image](https://github.com/user-attachments/assets/cfbe8e91-8e35-4688-88bd-4f8ff8e3157c)

![image](https://github.com/user-attachments/assets/a374b36d-6d54-4032-8371-680aabfadb0a)

![image](https://github.com/user-attachments/assets/cb944c35-ae3c-4ab4-b42f-8c86a8c4fd4b)


Tendo realizado estes processos poderá executar as requisições de login por exemplo no Postman.
